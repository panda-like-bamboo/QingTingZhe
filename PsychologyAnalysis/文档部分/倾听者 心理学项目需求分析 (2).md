

**“倾听者” AI 智能警务分析评估应用系统 - 需求分析 (V2.0 - 基于确认的技术栈和 AI 路径)**

**一、 项目概述与目标**

“倾听者”系统利用 AI 技术（结合自研 OCR、**预训练图像模型特征提取**、通义千问 VL 及大语言模型）和心理学评估方法（绘画、量表），对特定警务相关人群进行心理状态分析与评估。系统包含：

1.  **安卓 App (原生 Kotlin):** 用于数据采集。
2.  **后端 API 服务 (FastAPI + Python):** 处理业务逻辑、数据持久化、执行 AI 分析、提供接口。
3.  **数据库 (MySQL):** 存储所有系统数据。
4.  **后台管理系统 (Vue.js):** 用于数据查看、管理、分析和 AI 辅助功能交互。

**目标:** 为警务工作在未成年人犯罪预防、在押人员管理、上访户调解、民辅警关怀等方面提供数据驱动的决策支持、风险预警和智能辅助。

**二、 需求分析**

**A. 前端 - 安卓 App (原生 Kotlin)**

*   **用户认证 (FR-APP-01, 02):**
    *   提供符合 Material Design 的登录界面 (用户名/密码)。
    *   调用后端认证 API (`/auth/login`)，使用 Retrofit/OkHttp。
    *   安全存储 JWT Token (如 EncryptedSharedPreferences)。
*   **主界面 (FR-APP-03):**
    *   包含“分析评估”、“心理百科”（若实现）入口。
    *   采用 Bottom Navigation 或 Navigation Drawer 导航。
*   **分析评估模块 (核心流程):**
    *   **基本信息采集 (FR-APP-04):**
        *   使用标准 Android 控件 (EditText, Spinner, RadioButton, CheckBox) 构建表单。
        *   采集字段：姓名、性别、身份证号、年龄、职业、案件名称、案件类型（Spinner，数据源自 API `/lookups/case-types`）、人员身份（Spinner，数据源自 API `/lookups/identity-types`）、人员类型（Spinner，数据源自 API `/lookups/person-types`）、婚姻状况、子女情况、有无犯罪前科、健康情况、手机号、归属地（Spinner，数据源自 API `/lookups/domiciles`）。
        *   实现客户端输入校验。
    *   **绘画上传 (FR-APP-05):**
        *   集成 CameraX 或原生相机 Intent 拍照。
        *   集成 Activity Result API/相册 Intent 选择图片。
        *   提供图片预览。
    *   **量表测量 (FR-APP-06):**
        *   根据选择的量表类型，调用 API (`/scales/{scale_type}/questions`) 获取问题列表。
        *   使用 RecyclerView 动态展示问题和选项 (RadioGroup)。
        *   记录用户答案。
    *   **数据提交 (FR-APP-07):**
        *   将基础信息、量表答案（JSON 格式）、图片文件打包。
        *   调用后端数据提交 API (`/assessments/submit`)，使用 Retrofit/OkHttp 处理 `multipart/form-data` 上传。
        *   显示上传进度和结果反馈。
    *   **测评报告查看 (FR-APP-08):**
        *   提供查询接口（可能基于评估记录 ID 或用户关联记录）。
        *   调用后端报告查询 API (`/reports/{assessment_id}` 或类似接口)。
        *   解析并展示报告内容。

**B. 后端 - API 服务器 (FastAPI + Python)**

*   **API 接口 (RESTful, OpenAPI/Swagger 自动文档):**
    *   认证: `/auth/login`, `/auth/refresh`
    *   基础数据查询: `/lookups/{type}` (e.g., `/lookups/case-types`)
    *   量表: `/scales/{scale_type}/questions`
    *   评估提交: `POST /assessments/submit` (接收 App 数据)
    *   报告查询: `GET /reports`, `GET /reports/{id}`, `GET /reports/search`
    *   数据分析: `GET /analysis/stats` (带多维度查询参数)
    *   AI 辅助: `POST /ai/{assistance_type}` (e.g., `/ai/mediation_guidance`)
    *   用户管理: `GET /users`, `POST /users`, `PUT /users/{id}`, `DELETE /users/{id}` (及角色相关接口)
*   **核心业务逻辑:**
    *   **用户认证与授权 (FR-BE-CORE-01):** JWT 认证，基于角色的路径操作依赖项。
    *   **数据存储 (FR-BE-CORE-02):**
        *   使用 SQLAlchemy ORM 操作 MySQL 数据库。
        *   实现适配新 Schema 的数据保存逻辑（**重写 Demo 逻辑**）。
        *   图片存储至服务器指定路径或对象存储，路径存入数据库。
    *   **异步任务处理 (FR-BE-CORE-03):**
        *   使用 Celery + Redis/RabbitMQ。
        *   `/assessments/submit` 接口接收数据后，验证并存入数据库（标记状态为“处理中”），然后触发异步任务。
    *   **AI 分析与报告生成 (异步任务 - FR-BE-CORE-04):**
        *   **Input:** Assessment ID
        *   **Steps:**
            1.  从数据库加载评估数据 (图片路径、量表答案等)。
            2.  **本地图像处理 (运行于 CPU):**
                *   调用 OCR 服务/库获取图片文字信息。
                *   加载 **预训练轻量级图像模型 (如 MobileNetV2/V3, EfficientNet-B0)**，提取绘画图像的 **特征向量**。
            3.  调用 **通义千问 VL API**，可能结合 OCR 结果，获取图像的深层理解。
            4.  **量表处理:** 计算得分，根据规则库解释。
            5.  **整合分析:** 融合 OCR 结果、图像特征向量、VL 分析结果、量表解释。
            6.  **人格特征提取:** 实现基于整合分析结果生成人格特征的逻辑。
            7.  **报告生成:**
                *   构造包含所有分析结果的详细 **Prompt**。
                *   调用 **通义千问 LLM API** 生成报告文本。
                *   **持续进行 Prompt 调优** 以提升报告质量。
            8.  将生成的报告、特征向量、分析结果等存入数据库，更新评估记录状态为“完成”。
    *   **数据统计与分析 (FR-BE-CORE-05):** 实现基于 SQLAlchemy 的复杂查询和聚合逻辑。
    *   **AI 辅助模块 (FR-BE-CORE-06):**
        *   查询报告 -> 构造 Prompt -> 调用 LLM API -> 返回结果 -> 记录日志。
    *   **用户管理 (FR-BE-CORE-07):** 实现用户和角色的 CRUD 逻辑。

**C. 前端 - 后台管理系统 (Vue.js)**

*   **用户认证 (FR-ADM-01, 02):**
    *   登录页面，调用 `/auth/login`。
    *   使用 Axios 发送请求，Token 存入 localStorage/sessionStorage。
    *   配置 Vue Router 路由守卫。
*   **主界面/布局 (FR-ADM-03):**
    *   SPA 布局，使用 Element Plus / Naive UI / Ant Design Vue 组件库。
    *   侧边栏导航对应 7 大模块。
*   **模块 1: 查看测试报告 (FR-ADM-04, 05, 06):**
    *   查询表单 (姓名/身份证号)。
    *   使用 Table 组件展示分页结果 (调用 `/reports/search`)。
    *   点击查看详情 (Dialog/新页面，调用 `/reports/{id}`)。
*   **模块 2: 数据分析 (FR-ADM-07, 08):**
    *   筛选表单 (日期、多选框等)。
    *   调用 `/analysis/stats` API。
    *   使用 ECharts 或类似库展示图表，结合 Table。
*   **模块 3-6: AI 辅助功能 (FR-ADM-09 ~ 12 类推):**
    *   查询人员报告 -> 触发对应 AI 辅助 API (`/ai/{type}`) -> 展示返回结果。
*   **模块 7: 用户管理 (FR-ADM-13 ~ 16):**
    *   Table 展示用户列表 (调用 `/users`)。
    *   Dialog/页面 实现新增/编辑表单 (调用 `POST/PUT /users`)。
    *   操作按钮实现删除、角色分配 (调用 `DELETE /users`, `/users/{id}/role` 等)。

**三、 数据库数据结构 (MySQL + SQLAlchemy)**

*   采用上一轮分析中定义的表结构，使用 SQLAlchemy 定义数据模型 (Models)。
*   包括：`User`, `Role`, `Subject`, `Assessment`, `Scale`, `Question`, `Answer`, `Report`, `PersonalityTrait`, `AIAssistanceLog`, `Domicile`, `PersonType`, `IdentityType`, `CaseType` 等。
*   `Report` 表需要增加字段存储提取的图像特征向量 (可能序列化后存 TEXT/BLOB 或存文件路径) 和中间分析结果。
*   设计合适的索引以优化查询性能。
*   考虑敏感信息加密。

**四、 非功能性需求 (关键)**

*   **安全性:** API 权限控制、数据加密、防攻击、日志审计，满足警务系统安全标准。
*   **性能:** API 响应快，App 流畅，后台任务高效 (FastAPI, Kotlin Native, Celery 助力)。CPU 上的图像特征提取需确保性能可接受。
*   **可靠性:** 系统稳定，数据库备份恢复，AI 结果有一定稳定性。
*   **易用性:** App 和后台界面简洁直观，符合用户习惯。
*   **准确性:** 量表计分准确，**AI 分析（绘画、人格、辅助建议）的准确性和有效性是核心价值**。
*   **可维护性:** 代码结构清晰，FastAPI/Vue 模块化，类型提示，自动文档。
*   **合规性:** 遵守相关法律法规和警务规范。

**五、 基础设施要求**

*   需要服务器（云或本地）运行 FastAPI 应用、Celery Worker、MySQL 数据库、Redis/RabbitMQ 缓存/消息队列。
*   服务器 CPU 需要能承担轻量级图像模型（如 MobileNet）的推理负载（非实时）。
*   需要考虑网络带宽（图片上传、API 调用）。
*   需要部署 Nginx 等 Web 服务器/反向代理。
*   需要监控、日志、备份方案。

**六、 主要挑战与风险**

1.  **AI 效果:** 绘画分析（多模态融合）的准确性、人格特征提取的有效性、AI 辅助建议的实用性。
2.  **数据安全与合规:** 满足警务系统的高标准。
3.  **开发资源:** 团队需高效利用框架特性，合理安排优先级，进行迭代开发。
4.  **Prompt 工程:** 需要持续投入时间和精力优化 LLM 的 Prompt 以获得高质量输出。
5.  **本地模型性能:** 确保 CPU 上的图像特征提取性能满足后台任务需求。

